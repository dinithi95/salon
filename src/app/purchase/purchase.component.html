<nz-card nzTitle="PURCHASE ORDERS">

  <form nz-form [formGroup]="purchaseForm">
    <div nz-row>
      <div nz-col [nzMd]="12">
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="code">Code</nz-form-label>
          <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid Code!">
            <input nz-input formControlName="code" id="code" readonly placeholder="Type your code here"/>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="supplier">Supplier</nz-form-label>
          <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid Name!">
            <nz-select nzErrorTip="The input is not valid Supplier!"
                       nzShowSearch
                       nzAllowClear
                       nzPlaceHolder="Select Supplier"
                       formControlName="supplier_id"
                       id="supplier"
                       (ngModelChange)="getItemsBySupplier($event)"
            >
              <nz-option *ngFor="let supplier of suppliers" nzLabel="{{supplier.name}}"
                         [nzValue]="supplier.id"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

      </div>
      <div nz-col [nzMd]="12">
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="date">Date</nz-form-label>
          <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid Date!">
            <nz-date-picker
              formControlName="date"
              id="date"
              placeholder="Date of birth here"
              nzFormat="yyyy-MM-dd"
            ></nz-date-picker>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="status">Status</nz-form-label>
          <div nz-col [nzSm]="14" [nzXs]="24">
            <nz-select nzErrorTip="The input is not valid Status!"
                       nzShowSearch
                       nzAllowClear
                       nzPlaceHolder="Select Status"
                       formControlName="status"
                       id="status"
            >
              <nz-option nzLabel="Active" nzValue="Active"></nz-option>
              <nz-option nzLabel="Inactive" nzValue="Inactive"></nz-option>
            </nz-select>
          </div>
        </nz-form-item>
      </div>
    </div>

    <!-- Nested form===========================================================   -->

    <button nz-button (click)="addItem()">Add Item</button>

    <div nz-row>
      <div nz-col [nzMd]="24">

        <!--        <div formArrayName="items">-->
        <div *ngFor="let item of itemsArray.controls; let i=index" formArrayName="items">
          <div nz-row [formGroupName]="i">
            <div nz-col [nzMd]="11">

              <nz-form-item>
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="item">Item</nz-form-label>
                <div nz-col [nzSm]="14" [nzXs]="24">
                  <nz-select nzErrorTip="The input is not valid Item!"
                             nzShowSearch
                             nzAllowClear
                             nzPlaceHolder="Select Item"
                             formControlName="item_id"
                             id="item"
                  >
                    <nz-option *ngFor="let item of items" nzLabel="{{item.name}}" [nzValue]="item.id"></nz-option>
                  </nz-select>
                </div>
              </nz-form-item>
            </div>

            <div nz-col [nzMd]="11">
              <nz-form-item>
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="quantity">Quantity</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid Quantity!">
                  <input nz-input formControlName="quantity" id="quantity" placeholder="Type your quantity here"
                         (change)="calculateTotal()"/>
                </nz-form-control>
              </nz-form-item>
            </div>

            <div nz-col [nzMd]="2">
              <button nz-button (click)="removeItem(i)"> -</button>
            </div>
          </div>
        </div>
        <!--        </div>-->
      </div>
    </div>

    <!-- ===========================================================   -->
    <div nz-row>
      <div nz-col [nzMd]="12">
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="code">Total Price</nz-form-label>
          <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid Code!">
            <input nz-input formControlName="price" readonly id="price" placeholder="Type your code here"/>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>


    <div nz-row>
      <div nz-col [nzOffset]="13" [nzSpan]="6">
        <nz-form-item>
          <nz-form-control>
            <button nz-button (click)="resetForm()">Reset</button>
            <button nz-button
                    nzType="primary"
                    [disabled]="!purchaseForm.valid"
                    nz-popconfirm
                    nzPopconfirmTitle="Are you sure?"
                    (nzOnConfirm)="submitForm()"
                    nzPopconfirmPlacement="top">Submit
            </button>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>

  </form>
</nz-card>

<nz-card>
  <nz-table
      #nzTable
      [nzData]="displayPurchaseOrders"
      nzSize="small"
      nzTableLayout="fixed"
  >
    <thead>
    <tr>
      <th nzCustomFilter>
        Code
        <nz-filter-trigger
          [(nzVisible)]="visible"
          [nzActive]="searchValue.length > 0"
          [nzDropdownMenu]="menu"
        >
          <i nz-icon nzType="search"></i>
        </nz-filter-trigger>
      </th>
      <th>Date</th>
      <th>Supplier</th>
      <th>Price</th>
      <th>Status</th>
      <th style="width: 155px">Action</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let data of nzTable.data">
      <td>{{ data.code }}</td>
      <td>{{ data.date }}</td>
      <td>{{ data.supplier.name }}</td>
      <td>{{ data.price }}</td>
      <td>{{ data.status }}</td>
      <td><a nz-button nzType="link" (click)="showModal(data)">Edit</a></td>
    </tr>
    </tbody>
  </nz-table>
  <nz-dropdown-menu #menu="nzDropdownMenu">
    <div class="ant-table-filter-dropdown">
      <div class="search-box">
        <input
          type="text"
          nz-input
          placeholder="Search name"
          [(ngModel)]="searchValue"
        />
        <button
          nz-button
          nzSize="small"
          nzType="primary"
          (click)="search()"
          class="search-button"
        >
          Search
        </button>
        <button nz-button nzSize="small" (click)="resetSearch()">Reset</button>
      </div>
    </div>
  </nz-dropdown-menu>

  <nz-modal [(nzVisible)]="isVisible" nzTitle="Purchase Order" (nzOnCancel)="handleCancel()" (nzOnOk)="handleOk()">
    <H3>Purchase Order</H3>
    <label>Code :{{selectedPO?.code}}</label><br>
    <label>Date :{{selectedPO?.date}}</label><br>
    <label>Supplier :{{selectedPO?.supplier.name}}</label><br>
    <label>Total Price :{{selectedPO?.price}}</label><br>
    <label>Status :{{selectedPO?.status}}</label><br>

    <nz-table
        #nzTable1
        [nzData]="selectedPO"
        nzSize="small"
        nzTableLayout="fixed"
    >
      <thead>
      <tr>
        <th>Code</th>
        <th>Name</th>
        <th>Quantity</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let data of selectedPO?.items">
        <td>{{data.code}}</td>
        <td>{{data.name}}</td>
        <td>{{data.pivot.quantity}}</td>
      </tr>
      </tbody>
    </nz-table>
  </nz-modal>
</nz-card>
